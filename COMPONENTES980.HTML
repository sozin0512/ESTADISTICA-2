<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estado de Componentes FAH-980</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f2f5;
            color: #333;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            background: linear-gradient(to bottom, #87CEEB 0%, #ADD8E6 100%);
            padding-top: 40px;
            overflow-x: hidden;
        }

        h2 {
            text-align: center;
            font-weight: bold;
            font-size: 2.25rem;
            color: #2c3e50;
            margin-bottom: 2rem;
        }

        .container {
            background-color: #ffffff;
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            width: 95%;
            max-width: 1400px;
            margin-bottom: 20px;
            overflow-x: hidden;
        }

        .top-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            margin-bottom: 1rem;
            justify-content: center;
            width: 100%;
            max-width: 1400px;
        }

        .back-button, .print-all-button {
            padding: 0.75rem 1.5rem;
            background-color: #4f46e5;
            color: white;
            border-radius: 0.5rem;
            text-decoration: none;
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border: none; /* Asegura que no haya borde por defecto de botón */
            cursor: pointer;
        }

        .back-button:hover, .print-all-button:hover {
            background-color: #4338ca;
            transform: translateY(-2px);
        }

        .summary-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
            width: 100%;
        }

        .summary-card {
            background-color: #fefefe;
            border: 1px solid #e0e0e0;
            border-radius: 0.5rem;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: transform 0.2s ease;
        }
        .summary-card:hover {
            transform: translateY(-3px);
        }

        .summary-card h4 {
            font-weight: bold;
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            color: #333;
        }

        .summary-card .value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #4f46e5;
        }

        .component-detail-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1.5rem;
            width: 100%;
        }

        .component-card {
            background-color: #fefefe;
            border: 1px solid #e0e0e0;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            position: relative; /* Para posicionar los botones */
        }

        .component-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .component-card h4 {
            font-weight: bold;
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: #2c3e50;
            text-align: center;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 0.75rem;
        }

        .component-info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem 1rem;
            margin-bottom: 1rem;
        }

        .component-info-grid p {
            font-size: 0.95rem;
            color: #555;
        }

        .component-info-grid p strong {
            color: #333;
        }

        .remaining-life-section {
            background-color: #eef2ff;
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-top: auto; /* Empuja esta sección al final de la tarjeta */
            text-align: center;
            font-size: 1.1rem;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #c7d2fe;
        }

        .remaining-red { color: #dc2626; } /* Rojo más fuerte */
        .remaining-orange { color: #ea580c; } /* Naranja más fuerte */
        .remaining-green { color: #16a34a; } /* Verde más fuerte */

        .month-year-selector, .search-area {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            justify-content: center;
            align-items: center;
            width: 100%;
            max-width: 600px;
        }

        .month-year-selector label, .search-area label {
            font-weight: bold;
            color: #2c3e50;
        }

        .month-year-selector select, .search-area input {
            padding: 0.6rem 1rem;
            border: 1px solid #cbd5e0;
            border-radius: 0.5rem;
            background-color: #f8fafc;
            font-size: 1rem;
            cursor: pointer;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .month-year-selector select:focus, .search-area input:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
        }

        /* Estilos para los botones en la tarjeta */
        .card-buttons {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 0.5rem;
        }

        .edit-button, .print-single-button {
            background-color: #3b82f6; /* Azul */
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 0.375rem;
            font-size: 0.8rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s ease;
            border: none;
        }
        .edit-button:hover, .print-single-button:hover {
            background-color: #2563eb;
        }

        /* Estilos para el modal (dialog) */
        dialog {
            border: none;
            border-radius: 0.75rem;
            padding: 2rem;
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
            max-width: 600px;
            width: 90%;
            background-color: #ffffff;
            z-index: 1000; /* Asegura que esté por encima de otros elementos */
        }

        dialog::backdrop {
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(3px);
        }

        dialog h3 {
            font-size: 1.75rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        dialog form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        dialog form div {
            display: flex;
            flex-direction: column;
        }

        dialog form label {
            font-weight: bold;
            margin-bottom: 0.3rem;
            color: #444;
            font-size: 0.9rem;
        }

        dialog form input[type="text"],
        dialog form input[type="number"],
        dialog form input[type="date"],
        dialog form select {
            padding: 0.6rem;
            border: 1px solid #cbd5e0;
            border-radius: 0.375rem;
            font-size: 0.95rem;
            background-color: #f8fafc;
        }

        dialog form input:focus,
        dialog form select:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.2);
        }

        dialog .form-buttons {
            grid-column: span 2;
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        dialog .form-buttons button {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease;
        }

        dialog .form-buttons .save-button {
            background-color: #22c55e;
            color: white;
            border: none;
        }
        dialog .form-buttons .save-button:hover {
            background-color: #16a34a;
            transform: translateY(-1px);
        }

        dialog .form-buttons .cancel-button {
            background-color: #ef4444;
            color: white;
            border: none;
        }
        dialog .form-buttons .cancel-button:hover {
            background-color: #dc2626;
            transform: translateY(-1px);
        }

        /* Responsive para el modal */
        @media (max-width: 640px) {
            dialog form {
                grid-template-columns: 1fr;
            }
            dialog .form-buttons {
                flex-direction: column;
                align-items: stretch;
            }
        }

        /* Estilos para la barra de progreso */
        .progress-bar-container {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 0.5rem;
            height: 1.2rem; /* Altura de la barra */
            overflow: hidden; /* Asegura que el relleno no se desborde */
            margin-top: 1rem;
            border: 1px solid #ccc;
        }

        .progress-bar-fill {
            height: 100%;
            width: 0%; /* Se establecerá dinámicamente */
            border-radius: 0.5rem;
            transition: width 0.5s ease-in-out; /* Animación de llenado */
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            /* Propiedades para el efecto de "agua fluyendo" */
            background-size: 200% 100%; /* Duplica el tamaño para el movimiento */
            animation: flow 0.8s linear infinite; /* Animación de flujo, ahora más rápida (0.8s) */
        }

        /* Colores para la barra de progreso */
        .progress-red { 
            background-image: linear-gradient(90deg, #dc2626 0%, #ef4444 50%, #dc2626 100%);
        }
        .progress-orange { 
            background-image: linear-gradient(90deg, #ea580c 0%, #f97316 50%, #ea580c 100%);
        }
        .progress-green { 
            background-image: linear-gradient(90deg, #16a34a 0%, #22c55e 50%, #16a34a 100%);
        }

        /* Animación para el efecto de "agua fluyendo" */
        @keyframes flow {
            0% {
                background-position: 0% 0%;
            }
            100% {
                background-position: -100% 0%; /* Mueve el gradiente a la izquierda */
            }
        }

        /* Estilos para impresión */
        @media print {
            body {
                background: none; /* Elimina el fondo degradado */
                padding: 0;
                margin: 0;
                color: black; /* Texto negro para mejor contraste en impresión */
            }
            .top-buttons, .month-year-selector, .search-area, .edit-button, .print-single-button, dialog, .summary-section {
                display: none !important; /* Oculta elementos no necesarios para la impresión */
            }
            h2, h3 {
                color: black !important; /* Asegura que los títulos sean negros */
                text-align: center;
                margin-bottom: 1rem;
            }
            .container {
                box-shadow: none; /* Elimina sombras */
                border: none; /* Elimina bordes del contenedor principal */
                padding: 0;
                width: 100%;
                max-width: none;
            }
            .summary-card {
                display: none !important; /* Oculta las tarjetas de resumen */
            }
            .component-detail-section {
                grid-template-columns: 1fr; /* Una columna para impresión */
                gap: 1rem;
                margin-top: 0;
            }
            .component-card {
                border: 1px solid #ccc; /* Borde simple para cada componente */
                box-shadow: none; /* Elimina sombras */
                page-break-inside: avoid; /* Evita que las tarjetas se corten entre páginas */
                margin-bottom: 1rem; /* Espacio entre tarjetas */
                padding: 1rem;
            }
            .component-card h4 {
                border-bottom: 1px solid #eee; /* Borde más ligero para títulos de tarjeta */
                padding-bottom: 0.5rem;
                margin-bottom: 0.5rem;
            }
            .component-info-grid {
                grid-template-columns: 1fr; /* Una columna para las propiedades en impresión */
                gap: 0.5rem;
            }
            .remaining-life-section, .progress-bar-container {
                margin-top: 0.5rem;
                border: none; /* Elimina bordes de estas secciones */
                background-color: transparent; /* Fondo transparente */
            }
            .progress-bar-fill {
                background-image: none !important; /* Elimina el gradiente de la barra */
                background-color: #ddd !important; /* Color sólido para la barra de progreso */
                color: #333 !important; /* Texto oscuro para la barra */
                animation: none !important; /* Desactiva la animación de flujo */
            }
            /* Mostrar solo el componente seleccionado para impresión individual */
            body.print-single-component .component-card:not(.print-this-one) {
                display: none !important;
            }
            body.print-single-component .component-card.print-this-one {
                display: block !important; /* Asegura que solo se muestre el seleccionado */
                width: 100%; /* Ocupa todo el ancho disponible */
                margin: 0 auto; /* Centrar si es necesario */
            }
        }

    </style>
</head>
<body>
    <div class="top-buttons">
        <a href="HORAS980.HTML" class="back-button">Volver a Datos de Vuelo</a>
        <button id="printAllComponentsButton" class="print-all-button">Imprimir Todos los Componentes</button>
    </div>
    <h2 class="mt-8">Estado de Componentes</h2>

    <div class="container">
        <h3 class="text-xl font-semibold mb-4 text-center" id="summaryHeading">Resumen de Totales del Mes (desde Datos de Vuelo)</h3>
        
        <div class="month-year-selector">
            <label for="monthSelect">Mes:</label>
            <select id="monthSelect"></select>
            <label for="yearSelect">Año:</label>
            <select id="yearSelect"></select>
        </div>

        <div id="generalSummary" class="summary-section">
            <p class="text-center text-gray-600 col-span-full">Cargando resumen del mes...</p>
        </div>

        <h3 class="text-xl font-semibold mb-4 mt-8 text-center">Detalle de Componentes Principales</h3>
        
        <div class="search-area">
            <input type="text" id="componentSearchInput" placeholder="Buscar componente por nombre, serie o parte..." class="rounded-md">
        </div>

        <div id="componentDetails" class="component-detail-section">
            <p class="text-center text-gray-600 col-span-full">Cargando detalles de componentes...</p>
        </div>
    </div>

    <!-- Diálogo de Edición de Componente -->
    <dialog id="editComponentDialog">
        <h3>Editar Componente</h3>
        <form id="editComponentForm">
            <input type="hidden" id="edit-serialNumber-hidden">

            <div>
                <label for="edit-name">Descripción:</label>
                <input type="text" id="edit-name" name="name">
            </div>
            <div>
                <label for="edit-partNumber">N° de Parte:</label>
                <input type="text" id="edit-partNumber" name="partNumber">
            </div>
            <div>
                <label for="edit-serialNumber">N° de Serie:</label>
                <input type="text" id="edit-serialNumber" name="serialNumber"> <!-- Removed readonly here -->
            </div>
            <div>
                <label for="edit-installationDate">Instalado:</label>
                <input type="date" id="edit-installationDate" name="installationDate">
            </div>
            <div>
                <label for="edit-location">Ubicación:</label>
                <input type="text" id="edit-location" name="location">
            </div>
            <div>
                <label for="edit-type">Tipo de Vida:</label>
                <select id="edit-type" name="type">
                    <option value="hours">Horas</option>
                    <option value="cycles">Ciclos</option>
                    <option value="months">Meses</option>
                </select>
            </div>

            <div class="col-span-2 grid grid-cols-3 gap-4">
                <div>
                    <label for="edit-currentTSNHours">TSN (Hrs):</label>
                    <input type="number" id="edit-currentTSNHours" name="currentTSNHours">
                </div>
                <div>
                    <label for="edit-currentTSNCycles">TSN (Ciclos):</label>
                    <input type="number" id="edit-currentTSNCycles" name="currentTSNCycles">
                </div>
                <div>
                    <label for="edit-currentTSNDays">TSN (Días/Meses):</label>
                    <input type="number" id="edit-currentTSNDays" name="currentTSNDays">
                </div>
            </div>

            <div class="col-span-2 grid grid-cols-3 gap-4">
                <div>
                    <label for="edit-currentTSOHours">TSO (Hrs):</label>
                    <input type="number" id="edit-currentTSOHours" name="currentTSOHours">
                </div>
                <div>
                    <label for="edit-currentTSOCycles">TSO (Ciclos):</label>
                    <input type="number" id="edit-currentTSOCycles" name="currentTSOCycles">
                </div>
                <div>
                    <label for="edit-currentTSODays">TSO (Días/Meses):</label>
                    <input type="number" id="edit-currentTSODays" name="currentTSODays">
                </div>
            </div>

            <div class="col-span-2 grid grid-cols-3 gap-4">
                <div>
                    <label for="edit-lifeLimitHours">Vida Límite (Hrs):</label>
                    <input type="number" id="edit-lifeLimitHours" name="lifeLimitHours">
                </div>
                <div>
                    <label for="edit-lifeLimitCycles">Vida Límite (Ciclos):</label>
                    <input type="number" id="edit-lifeLimitCycles" name="lifeLimitCycles">
                </div>
                <div>
                    <label for="edit-lifeLimitDays">Vida Límite (Días/Meses):</label>
                    <input type="number" id="edit-lifeLimitDays" name="lifeLimitDays">
                </div>
            </div>

            <div>
                <label for="edit-dueDateTT">Vencimiento (A LAS TT):</label>
                <input type="text" id="edit-dueDateTT" name="dueDateTT">
            </div>
            <div>
                <label for="edit-status">Estado:</label>
                <input type="text" id="edit-status" name="status">
            </div>
            <div>
                <label for="edit-lastInspectionDate">Última Inspección:</label>
                <input type="date" id="edit-lastInspectionDate" name="lastInspectionDate">
            </div>
            <div>
                <label for="edit-nextInspectionDue">Próxima Inspección:</label>
                <input type="date" id="edit-nextInspectionDue" name="nextInspectionDue">
            </div>

            <div class="form-buttons">
                <button type="button" class="cancel-button" id="cancelEditButton">Cancelar</button>
                <button type="submit" class="save-button">Guardar Cambios</button>
            </div>
        </form>
    </dialog>

    <script type="module">
        // Importa las funciones necesarias de Firebase SDK para Realtime Database
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
        import { getAuth, onAuthStateChanged, signInAnonymously, signInWithCustomToken } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';
        import { getDatabase, ref, onValue, set } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js';

        // Configuración de Firebase (debe ser la misma que en HORAS980.HTML si la usas)
        const firebaseConfig = {
            apiKey: "AIzaSyC6pUgMRSRCZLZfW0Cy1b00AFN6nkPjsF8",
            authDomain: "fah-980-ceb96.firebaseapp.com",
            databaseURL: "https://fah-980-ceb96-default-rtdb.firebaseio.com",
            projectId: "fah-980-ceb96",
            storageBucket: "fah-980-ceb96.firebasestorage.app",
            messagingSenderId: "57890484294",
            appId: "1:57890484294:web:8a27759a4da0b262e99a47",
            measurementId: "G-HSZMRM7ZCS"
        };

        // Inicializa Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const auth = getAuth(app);

        const generalSummaryDiv = document.getElementById('generalSummary');
        const monthSelect = document.getElementById('monthSelect');
        const yearSelect = document.getElementById('yearSelect');
        const componentDetailsDiv = document.getElementById('componentDetails');
        const componentSearchInput = document.getElementById('componentSearchInput');
        const printAllComponentsButton = document.getElementById('printAllComponentsButton');

        // Referencias al diálogo y formulario de edición
        const editComponentDialog = document.getElementById('editComponentDialog');
        const editComponentForm = document.getElementById('editComponentForm');
        const cancelEditButton = document.getElementById('cancelEditButton');

        // Inputs del formulario de edición
        const editInputs = {
            serialNumberHidden: document.getElementById('edit-serialNumber-hidden'),
            name: document.getElementById('edit-name'),
            partNumber: document.getElementById('edit-partNumber'),
            serialNumber: document.getElementById('edit-serialNumber'),
            installationDate: document.getElementById('edit-installationDate'),
            location: document.getElementById('edit-location'),
            type: document.getElementById('edit-type'),
            currentTSNHours: document.getElementById('edit-currentTSNHours'),
            currentTSNCycles: document.getElementById('edit-currentTSNCycles'),
            currentTSNDays: document.getElementById('edit-currentTSNDays'),
            currentTSOHours: document.getElementById('edit-currentTSOHours'),
            currentTSOCycles: document.getElementById('edit-currentTSOCycles'),
            currentTSODays: document.getElementById('edit-currentTSODays'),
            lifeLimitHours: document.getElementById('edit-lifeLimitHours'),
            lifeLimitCycles: document.getElementById('edit-lifeLimitCycles'),
            lifeLimitDays: document.getElementById('edit-lifeLimitDays'),
            dueDateTT: document.getElementById('edit-dueDateTT'),
            status: document.getElementById('edit-status'),
            lastInspectionDate: document.getElementById('edit-lastInspectionDate'),
            nextInspectionDue: document.getElementById('edit-nextInspectionDue'),
        };

        // Define __app_id con un valor por defecto si no está definida
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        // Variables para el mes y año seleccionados
        let currentMonth = new Date().getMonth(); // 0-indexed (0 for January)
        let currentYear = new Date().getFullYear();

        // Variables globales para almacenar los totales mensuales
        let currentAcHrs = 0; 
        let currentRins = 0;

        const months = [
            "Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio",
            "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"
        ];
        const years = Array.from({ length: 11 }, (_, i) => new Date().getFullYear() - 5 + i);

        // Contador global para números de serie de nuevos componentes generados
        let globalSerialCounter = 1;

        // Función para generar un nuevo componente con valores por defecto
        function generateComponent(name, partNumber = "GEN-PN", type = "hours", lifeLimit = 2000, currentTSN = 500, location = "General") {
            const serialNum = `FAH-${String(globalSerialCounter++).padStart(4, '0')}`;
            let lifeLimitHours = 0, lifeLimitCycles = 0, lifeLimitDays = 0;
            let currentTSNHours = 0, currentTSNCycles = 0, currentTSNDays = 0;
            let dueDateTT = "";

            if (type === "hours") {
                lifeLimitHours = lifeLimit;
                currentTSNHours = currentTSN;
                dueDateTT = `${lifeLimit} hrs`;
            } else if (type === "cycles") {
                lifeLimitCycles = lifeLimit;
                currentTSNCycles = currentTSN;
                dueDateTT = `${lifeLimit} ciclos`;
            } else if (type === "months") {
                lifeLimitDays = lifeLimit * 30; // Suponiendo 30 días por mes para el límite de vida
                currentTSNDays = currentTSN * 30; // Suponiendo 30 días por mes para el TSN
                dueDateTT = `${lifeLimit} meses`;
            }

            return {
                name: name,
                partNumber: partNumber,
                serialNumber: serialNum,
                installationDate: "2023-01-01", // Fecha de instalación por defecto
                location: location,
                type: type,
                currentTSNHours: currentTSNHours,
                currentTSNCycles: currentTSNCycles,
                currentTSNDays: currentTSNDays,
                currentTSOHours: Math.floor(currentTSNHours * 0.2), // TSO como porcentaje del TSN
                currentTSOCycles: Math.floor(currentTSNCycles * 0.2),
                currentTSODays: Math.floor(currentTSNDays * 0.2),
                lifeLimitHours: lifeLimitHours,
                lifeLimitCycles: lifeLimitCycles,
                lifeLimitDays: lifeLimitDays,
                dueDateTT: dueDateTT,
                status: "Operativo",
                lastInspectionDate: "2024-01-01",
                nextInspectionDue: "2025-01-01"
            };
        }

        // Lista inicial de componentes (solo se usa si la base de datos está vacía)
        const initialPrincipalComponents = [
            generateComponent("Main Rotor Blade Assembly (RED)", "MRB-R", "hours", 5000, 4800, "Rotor Principal"),
            generateComponent("Main Rotor Blade Assembly (RED)", "MRB-R", "hours", 5000, 4700, "Rotor Principal"),
            generateComponent("Main Rotor Blade Assembly (BLUE)", "MRB-B", "hours", 5000, 3500, "Rotor Principal"),
            generateComponent("Main Rotor Blade Assembly (BLUE)", "MRB-B", "hours", 5000, 3400, "Rotor Principal"),
            generateComponent("Main Rotor Blade Assembly (ORANGE)", "MRB-O", "hours", 5000, 4100, "Rotor Principal"),
            generateComponent("Main Rotor Blade Assembly (ORANGE)", "MRB-O", "hours", 5000, 4000, "Rotor Principal"),
            generateComponent("Main Rotor Blade Assembly (GREEN)", "MRB-G", "hours", 5000, 1200, "Rotor Principal"),
            generateComponent("Main Rotor Blade Assembly (GREEN)", "MRB-G", "hours", 5000, 1100, "Rotor Principal"),
            generateComponent("Bolt Expandable", "BOLT-EXP", "cycles", 500, 450, "Varios"),
            generateComponent("Bolt Expandable", "BOLT-EXP", "cycles", 500, 400, "Varios"),
            generateComponent("Bolt Expandable", "BOLT-EXP", "cycles", 500, 350, "Varios"),
            generateComponent("Bolt Expandable", "BOLT-EXP", "cycles", 500, 300, "Varios"),
            generateComponent("Blade Bolt Assembly", "BBA-PN", "cycles", 1000, 800, "Rotor Principal"),
            generateComponent("Blade Bolt Assembly", "BBA-PN", "cycles", 1000, 750, "Rotor Principal"),
            generateComponent("Blade Bolt Assembly", "BBA-PN", "cycles", 1000, 700, "Rotor Principal"),
            generateComponent("Blade Bolt Assembly", "BBA-PN", "cycles", 1000, 650, "Rotor Principal"),
            generateComponent("Main Rotor Hub Assembly", "MRH-A", "hours", 4000, 3900, "Principal"),
            generateComponent("Main Rotor Hub Assembly", "MRH-B", "hours", 4000, 2800, "Principal"),
            generateComponent("Yoke Assembly", "YOKE-A", "hours", 2500, 1800, "Principal"),
            generateComponent("Yoke Assembly", "YOKE-B", "hours", 2500, 1500, "Principal"),
            generateComponent("Seat, Lower Cone", "SLC-PN", "hours", 1500, 500, "Tren de Aterrizaje"),
            generateComponent("Plate Assembly", "PLATE-A", "hours", 1000, 300, "Estructura"),
            generateComponent("Plate Assembly", "PLATE-B", "hours", 1000, 250, "Estructura"),
            generateComponent("Seat, Upper Cone", "SUC-PN", "hours", 1500, 600, "Tren de Aterrizaje"),
            generateComponent("Drive Pin", "PIN-DR-1", "cycles", 1000, 750, "Tren de Aterrizaje"),
            generateComponent("Drive Pin", "PIN-DR-2", "cycles", 1000, 700, "Tren de Aterrizaje"),
            generateComponent("Drive Pin", "PIN-DR-3", "cycles", 1000, 650, "Tren de Aterrizaje"),
            generateComponent("Drive Pin", "PIN-DR-4", "cycles", 1000, 600, "Tren de Aterrizaje"),
            generateComponent("Drive Pin", "PIN-DR-5", "cycles", 1000, 550, "Tren de Aterrizaje"),
            generateComponent("Drive Pin", "PIN-DR-6", "cycles", 1000, 500, "Tren de Aterrizaje"),
            generateComponent("Drive Pin", "PIN-DR-7", "cycles", 1000, 450, "Tren de Aterrizaje"),
            generateComponent("Drive Pin", "PIN-DR-8", "cycles", 1000, 400, "Tren de Aterrizaje"),
            generateComponent("Arm Assembly", "ARM-A-1", "hours", 1200, 500, "Controles de Vuelo"),
            generateComponent("Arm Assembly", "ARM-A-2", "hours", 1200, 480, "Controles de Vuelo"),
            generateComponent("Arm Assembly", "ARM-A-3", "hours", 1200, 460, "Controles de Vuelo"),
            generateComponent("Arm Assembly", "ARM-A-4", "hours", 1200, 440, "Controles de Vuelo"),
            generateComponent("Arm Assembly", "ARM-A-5", "hours", 1200, 420, "Controles de Vuelo"),
            generateComponent("Arm Assembly", "ARM-A-6", "hours", 1200, 400, "Controles de Vuelo"),
            generateComponent("Arm Assembly", "ARM-A-7", "hours", 1200, 380, "Controles de Vuelo"),
            generateComponent("Arm Assembly", "ARM-A-8", "hours", 1200, 360, "Controles de Vuelo"),
            generateComponent("Bracket Assembly", "BRKT-A-1", "hours", 1500, 600, "Estructura"),
            generateComponent("Bracket Assembly", "BRKT-A-2", "hours", 1500, 580, "Estructura"),
            generateComponent("Bracket Assembly", "BRKT-A-3", "hours", 1500, 560, "Estructura"),
            generateComponent("Bracket Assembly", "BRKT-A-4", "hours", 1500, 540, "Estructura"),
            generateComponent("Bracket Assembly", "BRKT-A-5", "hours", 1500, 520, "Estructura"),
            generateComponent("Bracket Assembly", "BRKT-A-6", "hours", 1500, 500, "Estructura"),
            generateComponent("Bracket Assembly", "BRKT-A-7", "hours", 1500, 480, "Estructura"),
            generateComponent("Bracket Assembly", "BRKT-A-8", "hours", 1500, 460, "Estructura"),
            generateComponent("Damper Bridge Assembly", "DBA-PN-1", "hours", 1500, 1200, "Rotor Principal"),
            generateComponent("Damper Bridge Assembly", "DBA-PN-2", "hours", 1500, 1150, "Rotor Principal"),
            generateComponent("Damper Bridge Assembly", "DBA-PN-3", "hours", 1500, 1100, "Rotor Principal"),
            generateComponent("Damper Bridge Assembly", "DBA-PN-4", "hours", 1500, 1050, "Rotor Principal"),
            generateComponent("Damper Bridge Assembly", "DBA-PN-5", "hours", 1500, 1000, "Rotor Principal"),
            generateComponent("Damper Bridge Assembly", "DBA-PN-6", "hours", 1500, 950, "Rotor Principal"),
            generateComponent("Damper Bridge Assembly", "DBA-PN-7", "hours", 1500, 900, "Rotor Principal"),
            generateComponent("Damper Bridge Assembly", "DBA-PN-8", "hours", 1500, 850, "Rotor Principal"),
            generateComponent("Damper Bridge Assembly", "DBA-PN-9", "hours", 1500, 800, "Rotor Principal"),
            generateComponent("Damper Bridge Assembly", "DBA-PN-10", "hours", 1500, 750, "Rotor Principal"),
            generateComponent("Damper Bridge Assembly", "DBA-PN-11", "hours", 1500, 700, "Rotor Principal"),
            generateComponent("Damper Bridge Assembly", "DBA-PN-12", "hours", 1500, 650, "Rotor Principal"),
            generateComponent("Spindle And Damper Bearing", "SDB-PN-1", "cycles", 800, 650, "Rotor Principal"),
            generateComponent("Spindle And Damper Bearing", "SDB-PN-2", "cycles", 800, 600, "Rotor Principal"),
            generateComponent("Spindle And Damper Bearing", "SDB-PN-3", "cycles", 800, 550, "Rotor Principal"),
            generateComponent("Spindle And Damper Bearing", "SDB-PN-4", "cycles", 800, 500, "Rotor Principal"),
            generateComponent("Pitch Horn Assembly", "PHA-PN-1", "hours", 1000, 700, "Rotor Principal"),
            generateComponent("Pitch Horn Assembly", "PHA-PN-2", "hours", 1000, 650, "Rotor Principal"),
            generateComponent("Pitch Horn Assembly", "PHA-PN-3", "hours", 1000, 600, "Rotor Principal"),
            generateComponent("Pitch Horn Assembly", "PHA-PN-4", "hours", 1000, 550, "Rotor Principal"),
            generateComponent("Fitting", "FIT-PN-1", "cycles", 700, 550, "Cola"),
            generateComponent("Fitting", "FIT-PN-2", "cycles", 700, 500, "Cola"),
            generateComponent("Fitting", "FIT-PN-3", "cycles", 700, 450, "Cola"),
            generateComponent("Fitting", "FIT-PN-4", "cycles", 700, 400, "Cola"),
            generateComponent("Bolt, Weight", "BW-PN-1", "cycles", 500, 300, "Varios"),
            generateComponent("Bolt, Weight", "BW-PN-2", "cycles", 500, 280, "Varios"),
            generateComponent("Bolt, Weight", "BW-PN-3", "cycles", 500, 260, "Varios"),
            generateComponent("Bolt, Weight", "BW-PN-4", "cycles", 500, 240, "Varios"),
            generateComponent("Bolt, Arm", "BA-PN-1", "cycles", 500, 350, "Varios"),
            generateComponent("Bolt, Arm", "BA-PN-2", "cycles", 500, 330, "Varios"),
            generateComponent("Bolt, Arm", "BA-PN-3", "cycles", 500, 310, "Varios"),
            generateComponent("Bolt, Arm", "BA-PN-4", "cycles", 500, 290, "Varios"),
            generateComponent("Bolt, Bracket", "BB-PN-1", "cycles", 500, 200, "Varios"),
            generateComponent("Bolt, Bracket", "BB-PN-2", "cycles", 500, 190, "Varios"),
            generateComponent("Bolt, Bracket", "BB-PN-3", "cycles", 500, 180, "Varios"),
            generateComponent("Bolt, Bracket", "BB-PN-4", "cycles", 500, 170, "Varios"),
            generateComponent("Bolt, Bracket", "BB-PN-5", "cycles", 500, 160, "Varios"),
            generateComponent("Bolt, Bracket", "BB-PN-6", "cycles", 500, 150, "Varios"),
            generateComponent("Bolt, Bracket", "BB-PN-7", "cycles", 500, 140, "Varios"),
            generateComponent("Bolt, Bracket", "BB-PN-8", "cycles", 500, 130, "Varios"),
            generateComponent("Bolt, Bracket", "BB-PN-9", "cycles", 500, 120, "Varios"),
            generateComponent("Bolt, Bracket", "BB-PN-10", "cycles", 500, 110, "Varios"),
            generateComponent("Bolt, Bracket", "BB-PN-11", "cycles", 500, 100, "Varios"),
            generateComponent("Bolt, Bracket", "BB-PN-12", "cycles", 500, 90, "Varios"),
            generateComponent("Bolt, Bracket", "BB-PN-13", "cycles", 500, 80, "Varios"),
            generateComponent("Bolt, Bracket", "BB-PN-14", "cycles", 500, 70, "Varios"),
            generateComponent("Bolt, Bracket", "BB-PN-15", "cycles", 500, 60, "Varios"),
            generateComponent("Bolt, Bracket", "BB-PN-16", "cycles", 500, 50, "Varios"),
            generateComponent("Bushing, Yoke", "BY-PN", "hours", 1000, 400, "Principal"),
            generateComponent("Cap", "CAP-PN", "months", 24, 12, "Varios"),
            generateComponent("Cone Superior", "CS-PN", "hours", 800, 300, "Tren de Aterrizaje"),
            generateComponent("Cone Inferior", "CI-PN", "hours", 800, 300, "Tren de Aterrizaje"),
            generateComponent("Cam To Upper Yoke", "CTUY-PN-1", "cycles", 1000, 600, "Controles de Vuelo"),
            generateComponent("Cam To Upper Yoke", "CTUY-PN-2", "cycles", 1000, 580, "Controles de Vuelo"),
            generateComponent("Cam To Upper Yoke", "CTUY-PN-3", "cycles", 1000, 560, "Controles de Vuelo"),
            generateComponent("Cam To Upper Yoke", "CTUY-PN-4", "cycles", 1000, 540, "Controles de Vuelo"),
            generateComponent("Cam To Upper Yoke", "CTUY-PN-5", "cycles", 1000, 520, "Controles de Vuelo"),
            generateComponent("Cam To Upper Yoke", "CTUY-PN-6", "cycles", 1000, 500, "Controles de Vuelo"),
            generateComponent("Cam To Upper Yoke", "CTUY-PN-7", "cycles", 1000, 480, "Controles de Vuelo"),
            generateComponent("Cam To Upper Yoke", "CTUY-PN-8", "cycles", 1000, 460, "Controles de Vuelo"),
            generateComponent("Upper Yoke To Cam", "UYTC-PN-1", "cycles", 1000, 550, "Controles de Vuelo"),
            generateComponent("Upper Yoke To Cam", "UYTC-PN-2", "cycles", 1000, 530, "Controles de Vuelo"),
            generateComponent("Upper Yoke To Cam", "UYTC-PN-3", "cycles", 1000, 510, "Controles de Vuelo"),
            generateComponent("Upper Yoke To Cam", "UYTC-PN-4", "cycles", 1000, 490, "Controles de Vuelo"),
            generateComponent("Upper Yoke To Cam", "UYTC-PN-5", "cycles", 1000, 470, "Controles de Vuelo"),
            generateComponent("Upper Yoke To Cam", "UYTC-PN-6", "cycles", 1000, 450, "Controles de Vuelo"),
            generateComponent("Upper Yoke To Cam", "UYTC-PN-7", "cycles", 1000, 430, "Controles de Vuelo"),
            generateComponent("Upper Yoke To Cam", "UYTC-PN-8", "cycles", 1000, 410, "Controles de Vuelo"),
            generateComponent("Clevis To Cam", "CTC-PN-1", "cycles", 800, 400, "Controles de Vuelo"),
            generateComponent("Clevis To Cam", "CTC-PN-2", "cycles", 800, 380, "Controles de Vuelo"),
            generateComponent("Clevis To Cam", "CTC-PN-3", "cycles", 800, 360, "Controles de Vuelo"),
            generateComponent("Clevis To Cam", "CTC-PN-4", "cycles", 800, 340, "Controles de Vuelo"),
            generateComponent("Clevis Assy To Lower Cone", "CALC-PN-1", "cycles", 800, 350, "Controles de Vuelo"),
            generateComponent("Clevis Assy To Lower Cone", "CALC-PN-2", "cycles", 800, 330, "Controles de Vuelo"),
            generateComponent("Clevis Assy To Lower Cone", "CALC-PN-3", "cycles", 800, 310, "Controles de Vuelo"),
            generateComponent("Clevis Assy To Lower Cone", "CALC-PN-4", "cycles", 800, 290, "Controles de Vuelo"),
            generateComponent("Control System Bolts", "CSB-PN", "hours", 2000, 800, "Controles de Vuelo"),
            generateComponent("Sup. Control System Bolt", "SCSB-PN-1", "hours", 1000, 400, "Controles de Vuelo"),
            generateComponent("Sup. Control System Bolt", "SCSB-PN-2", "hours", 1000, 380, "Controles de Vuelo"),
            generateComponent("Sup. Control System Bolt", "SCSB-PN-3", "hours", 1000, 360, "Controles de Vuelo"),
            generateComponent("M/R Pitch Link Assembly", "MRPLA-PN-1", "hours", 1200, 900, "Rotor Principal"),
            generateComponent("M/R Pitch Link Assembly", "MRPLA-PN-2", "hours", 1200, 850, "Rotor Principal"),
            generateComponent("M/R Pitch Link Assembly", "MRPLA-PN-3", "hours", 1200, 800, "Rotor Principal"),
            generateComponent("M/R Pitch Link Assembly", "MRPLA-PN-4", "hours", 1200, 750, "Rotor Principal"),
            generateComponent("P/C Link Tube", "PCLT-PN-1", "hours", 1000, 700, "Rotor Principal"),
            generateComponent("P/C Link Tube", "PCLT-PN-2", "hours", 1000, 650, "Rotor Principal"),
            generateComponent("P/C Link Tube", "PCLT-PN-3", "hours", 1000, 600, "Rotor Principal"),
            generateComponent("P/C Link Tube", "PCLT-PN-4", "hours", 1000, 550, "Rotor Principal"),
            generateComponent("Bearing Rod End", "BRE-PN-1", "cycles", 500, 300, "Varios"),
            generateComponent("Bearing Rod End", "BRE-PN-2", "cycles", 500, 280, "Varios"),
            generateComponent("Bearing Rod End", "BRE-PN-3", "cycles", 500, 260, "Varios"),
            generateComponent("Bearing Rod End", "BRE-PN-4", "cycles", 500, 240, "Varios"),
            generateComponent("Bearing Rod End", "BRE-PN-5", "cycles", 500, 220, "Varios"),
            generateComponent("Bearing Rod End", "BRE-PN-6", "cycles", 500, 200, "Varios"),
            generateComponent("Hub & Sleeve Assembly", "HSA-PN", "hours", 2000, 1800, "Controles de Vuelo"),
            generateComponent("Scissors Hub", "SHUB-PN", "hours", 1500, 1000, "Controles de Vuelo"),
            generateComponent("Lever Driver Assembly", "LDA-PN-1", "hours", 1000, 700, "Controles de Vuelo"),
            generateComponent("Lever Driver Assembly", "LDA-PN-2", "hours", 1000, 650, "Controles de Vuelo"),
            generateComponent("Lever Driver Assembly", "LDA-PN-3", "hours", 1000, 600, "Controles de Vuelo"),
            generateComponent("Lever Driver Assembly", "LDA-PN-4", "hours", 1000, 550, "Controles de Vuelo"),
            generateComponent("Lever Driver Assembly", "LDA-PN-5", "hours", 1000, 500, "Controles de Vuelo"),
            generateComponent("Collective Sleeve", "CSLEEVE-PN", "hours", 1500, 1200, "Controles de Vuelo"),
            generateComponent("Swashplate Link Assembly", "SLA-PN-1", "hours", 1000, 800, "Controles de Vuelo"),
            generateComponent("Swashplate Link Assembly", "SLA-PN-2", "hours", 1000, 750, "Controles de Vuelo"),
            generateComponent("Link Tube", "LTUBE-PN-1", "hours", 800, 500, "Controles de Vuelo"),
            generateComponent("Link Tube", "LTUBE-PN-2", "hours", 800, 450, "Controles de Vuelo"),
            generateComponent("Swashplate & Support Assembly", "SSA-PN", "hours", 3200, 2900, "Controles de Vuelo"),
            generateComponent("Gimbal Ring", "GRING-PN", "hours", 2500, 1800, "Controles de Vuelo"),
            generateComponent("Outer Ring", "ORING-PN", "hours", 2500, 1700, "Controles de Vuelo"),
            generateComponent("Support Assembly", "SUPA-PN", "hours", 2000, 1500, "Controles de Vuelo"),
            generateComponent("Collective Lever", "CL-PN-1", "hours", 1500, 1000, "Controles de Vuelo"),
            generateComponent("Collective Lever", "CL-PN-2", "hours", 1500, 950, "Controles de Vuelo"),
            generateComponent("Mast Assembly", "MAST-A-1", "hours", 4500, 3800, "Estructura"),
            generateComponent("Mast Assembly", "MAST-A-2", "hours", 4500, 3600, "Estructura"),
            generateComponent("Mast Assembly", "MAST-A-3", "hours", 4500, 3400, "Estructura"),
            generateComponent("Mast Pole", "MP-PN-1", "hours", 4500, 3800, "Estructura"),
            generateComponent("Mast Pole", "MP-PN-2", "hours", 4500, 3600, "Estructura"),
            generateComponent("Main Gearbox Assembly", "MGA-A", "hours", 8000, 6800, "Transmisión"),
            generateComponent("Gearbox Assembly", "GBA-A", "hours", 6000, 5200, "Transmisión"),
            generateComponent("Quill Assembly Hydraulic Drive", "QAHD-PN", "hours", 1000, 700, "Transmisión"),
            generateComponent("Main Input Quills", "MIQ-A", "hours", 3000, 2500, "Transmisión"),
            generateComponent("Main Input Quill Gen", "MIQG-A", "hours", 3000, 2800, "Transmisión"),
            generateComponent("Quill T/R Drive", "QTRD-A", "hours", 2500, 1800, "Transmisión"),
            generateComponent("Spider", "SPIDER-PN-1", "cycles", 1000, 700, "Transmisión"),
            generateComponent("Spider", "SPIDER-PN-2", "cycles", 1000, 650, "Transmisión"),
            generateComponent("Rotor Brake Quill", "RBQ-PN", "hours", 1500, 800, "Transmisión"),
            generateComponent("Main Driveshaft", "MDS-A", "hours", 4000, 3200, "Transmisión"),
            generateComponent("Hydraulic Cylinder Assy (Coll.)", "HCA-A", "hours", 2500, 2000, "Controles de Vuelo"),
            generateComponent("Hydraulic Cylinder Assy (RH)", "HCA-B", "hours", 2500, 2300, "Controles de Vuelo"),
            generateComponent("Hydraulic Cylinder Assy (LH)", "HCA-C", "hours", 2500, 1500, "Controles de Vuelo"),
            generateComponent("Main Actuator", "MA-A", "hours", 3000, 2500, "Controles de Vuelo"),
            generateComponent("Hanger Assembly", "HA-PN-1", "hours", 2200, 1800, "Transmisión"),
            generateComponent("Hanger Assembly", "HA-PN-2", "hours", 2200, 1750, "Transmisión"),
            generateComponent("Hanger Assembly", "HA-PN-3", "hours", 2200, 1700, "Transmisión"),
            generateComponent("Hanger Assembly", "HA-PN-4", "hours", 2200, 1650, "Transmisión"),
            generateComponent("Hanger Assembly", "HA-PN-5", "hours", 2200, 1600, "Transmisión"),
            generateComponent("Hanger Assembly", "HA-PN-6", "hours", 2200, 1550, "Transmisión"),
            generateComponent("T/R Driveshaft Coupling", "TRDC-PN-1", "hours", 1000, 700, "Transmisión"),
            generateComponent("T/R Driveshaft Coupling", "TRDC-PN-2", "hours", 1000, 650, "Transmisión"),
            generateComponent("T/R Driveshaft Coupling", "TRDC-PN-3", "hours", 1000, 600, "Transmisión"),
            generateComponent("T/R Driveshaft Coupling", "TRDC-PN-4", "hours", 1000, 550, "Transmisión"),
            generateComponent("42 Gearbox", "42GB-PN-1", "hours", 3000, 2000, "Transmisión"),
            generateComponent("42 Gearbox", "42GB-PN-2", "hours", 3000, 1800, "Transmisión"),
            generateComponent("Tail Gearbox Assembly", "TGA-A", "hours", 3500, 2800, "Rotor de Cola"),
            generateComponent("90 Gearbox", "90GB-PN", "hours", 3500, 2500, "Rotor de Cola"),
            generateComponent("T/R Hub Assembly", "TRHA-PN", "hours", 2000, 1500, "Rotor de Cola"),
            generateComponent("T/R Yoke Idler Assembly", "TRYIA-PN", "hours", 1500, 1000, "Rotor de Cola"),
            generateComponent("Lever Assembly", "LVR-PN", "hours", 1200, 800, "Rotor de Cola"),
            generateComponent("T/R Retention Nut", "TRRN-PN", "months", 36, 24, "Rotor de Cola"),
            generateComponent("Crosshead Link Assembly", "CHLA-PN", "hours", 1000, 700, "Rotor de Cola"),
            generateComponent("Tail Rotor Blade Assembly", "TRB-PN-1", "hours", 3000, 2500, "Rotor de Cola"),
            generateComponent("Tail Rotor Blade Assembly", "TRB-PN-2", "hours", 3000, 2700, "Rotor de Cola"),
            generateComponent("FIRE EXTINGUISHER # 1", "FE-A01-1", "months", 60, 48, "Cabina"),
            generateComponent("FIRE EXTINGUISHER # 1", "FE-A01-2", "months", 60, 55, "Cabina"),
            generateComponent("CARTRIDGE", "CART-A01-1", "months", 60, 48, "Cabina"),
            generateComponent("CARTRIDGE", "CART-A01-2", "months", 60, 55, "Cabina"),
            generateComponent("FIRE EXTINGUISHER # 2", "FE-A02-1", "months", 60, 48, "Cabina"),
            generateComponent("FIRE EXTINGUISHER # 2", "FE-A02-2", "months", 60, 55, "Cabina"),
            generateComponent("STARTER GENERATOR # 1", "SG-B01-1", "hours", 1500, 1200, "Motor 1"),
            generateComponent("STARTER GENERATOR # 2", "SG-B01-2", "hours", 1500, 1400, "Motor 2"),
            generateComponent("BLOWER OIL COOLER BEARING (2)", "BOCB-C01-1", "cycles", 800, 650, "Motor 1"),
            generateComponent("BLOWER OIL COOLER BEARING (2)", "BOCB-C01-2", "cycles", 800, 780, "Motor 2"),
            generateComponent("ENGINE PT6T-3B # 1", "PT6T-3B-1", "hours", 3600, 3000, "Motor 1"),
            generateComponent("MANUAL FUEL CONTROL", "MFC-D01-1", "hours", 2000, 1600, "Motor 1"),
            generateComponent("MANUAL FUEL CONTROL", "MFC-D01-2", "hours", 2000, 1500, "Motor 2"),
            generateComponent("AUTOMATIC FUEL CONTROL", "AFC-E01-1A", "hours", 2000, 1800, "Motor 1"),
            generateComponent("AUTOMATIC FUEL CONTROL", "AFC-E01-1B", "hours", 2000, 1950, "Motor 1"),
            generateComponent("AUTOMATIC FUEL CONTROL", "AFC-E01-1C", "hours", 2000, 1500, "Motor 1"),
            generateComponent("AUTOMATIC FUEL CONTROL", "AFC-E01-1D", "hours", 2000, 1700, "Motor 1"),
            generateComponent("AUTOMATIC FUEL CONTROL", "AFC-E01-2A", "hours", 2000, 1750, "Motor 2"),
            generateComponent("AUTOMATIC FUEL CONTROL", "AFC-E01-2B", "hours", 2000, 1900, "Motor 2"),
            generateComponent("AUTOMATIC FUEL CONTROL", "AFC-E01-2C", "hours", 2000, 1400, "Motor 2"),
            generateComponent("AUTOMATIC FUEL CONTROL", "AFC-E01-2D", "hours", 2000, 1650, "Motor 2"),
            generateComponent("FUEL PUMP", "FP-F01-1", "hours", 1800, 1500, "Motor 1"),
            generateComponent("FUEL PUMP", "FP-F01-2", "hours", 1800, 1450, "Motor 2"),
            generateComponent("OIL TO FUEL HEATER", "OFH-G01-1", "hours", 1800, 1700, "Motor 1"),
            generateComponent("OIL TO FUEL HEATER", "OFH-G01-2", "hours", 1800, 1600, "Motor 2"),
            generateComponent("BLEED VALVE", "BV-H01-1", "hours", 1200, 900, "Motor 1"),
            generateComponent("BLEED VALVE", "BV-H01-2", "hours", 1200, 850, "Motor 2"),
            generateComponent("FLOW DIVIDER", "FD-I01-1", "hours", 1200, 1100, "Motor 1"),
            generateComponent("FLOW DIVIDER", "FD-I01-2", "hours", 1200, 1050, "Motor 2"),
            generateComponent("FUEL SURGE ACCUMULATOR", "FSA-J01-1", "hours", 1000, 800, "Motor 1"),
            generateComponent("FUEL SURGE ACCUMULATOR", "FSA-J01-2", "hours", 1000, 750, "Motor 2"),
            generateComponent("TRIM COMPENSATOR", "TC-K01-1", "hours", 1000, 950, "Motor 1"),
            generateComponent("TRIM COMPENSADOR", "TC-K01-2", "hours", 1000, 900, "Motor 2"),
            generateComponent("IGNITION EXCITER", "IE-L01-1", "cycles", 500, 400, "Motor 1"),
            generateComponent("IGNITION EXCITER", "IE-L01-2", "cycles", 500, 380, "Motor 2"),
            generateComponent("IGNITION CABLE (2)", "IC-M01-1", "cycles", 500, 480, "Motor 1"),
            generateComponent("IGNITION CABLE (2)", "IC-M01-2", "cycles", 500, 450, "Motor 2"),
            generateComponent("DISK-STG 1 P.T.", "DS1PT-N01-1A", "cycles", 2500, 2000, "Motor 1"),
            generateComponent("DISK-STG 1 P.T.", "DS1PT-N01-1B", "cycles", 2500, 2300, "Motor 1"),
            generateComponent("DISK-STG 1 P.T.", "DS1PT-N01-2A", "cycles", 2500, 1900, "Motor 2"),
            generateComponent("DISK-STG 1 P.T.", "DS1PT-N01-2B", "cycles", 2500, 2200, "Motor 2"),
            generateComponent("IMPELLER", "IMP-O01-1", "cycles", 2000, 1600, "Motor 1"),
            generateComponent("IMPELLER", "IMP-O01-2", "cycles", 2000, 1550, "Motor 2"),
            generateComponent("DISK-STG 3 COMPRESSOR", "DS3C-P01-1", "cycles", 2000, 1800, "Motor 1"),
            generateComponent("DISK-STG 3 COMPRESSOR", "DS3C-P01-2", "cycles", 2000, 1750, "Motor 2"),
            generateComponent("DISK-STG 2 COMPRESSOR", "DS2C-Q01-1", "cycles", 2000, 1950, "Motor 1"),
            generateComponent("DISK-STG 2 COMPRESSOR", "DS2C-Q01-2", "cycles", 2000, 1850, "Motor 2"),
            generateComponent("REAR HUB", "RH-R01-1A", "cycles", 1500, 1200, "Motor 1"),
            generateComponent("REAR HUB", "RH-R01-1B", "cycles", 1500, 1400, "Motor 1"),
            generateComponent("REAR HUB", "RH-R01-2A", "cycles", 1500, 1150, "Motor 2"),
            generateComponent("REAR HUB", "RH-R01-2B", "cycles", 1500, 1350, "Motor 2"),
            generateComponent("DISK-COMPRESSOR TURBINE", "DCT-S01-1", "cycles", 1800, 1500, "Motor 1"),
            generateComponent("DISK-COMPRESSOR TURBINE", "DCT-S01-2", "cycles", 1800, 1400, "Motor 2"),
            generateComponent("COMBINING GEARBOX", "CGB-T01", "hours", 4000, 3200, "Transmisión Central"),
            generateComponent("NF GOVERNOR # 1", "NFG-U01-1", "hours", 1500, 1200, "Motor 1"),
            generateComponent("NF GOVERNOR # 2", "NFG-U01-2", "hours", 1500, 1400, "Motor 2"),
            generateComponent("TORQUE CONTROL UNIT", "TCU-V01", "hours", 1200, 900, "Motor"),
            generateComponent("AFT CROSSTUBE", "ACT-W01", "hours", 2500, 2000, "Estructura"),
            generateComponent("MOTOR & BLADE ASSY #1", "MBA-X01-1", "hours", 1000, 800, "Tren de Aterrizaje"),
            generateComponent("MOTOR & BLADE ASSY #2", "MBA-X01-2", "hours", 1000, 950, "Tren de Aterrizaje"),
            generateComponent("SPEED REDUCER BEARING", "SRB-Y01", "cycles", 800, 650, "Transmisión"),
            generateComponent("COMPRESSOR ASSY", "CA-Z01", "hours", 1800, 1500, "Motor"),
            generateComponent("ARTEX 406 ELT BATTERY", "ELT-AA01-1", "months", 12, 10, "Aviónica"),
            generateComponent("ARTEX 406 ELT BATTERY", "ELT-AA01-2", "months", 12, 5, "Aviónica"),
        ];

        // Variable para almacenar los componentes cargados desde Firebase
        let principalComponents = [];


        /**
         * Calcula la vida restante de un componente basándose en su tipo principal.
         * @param {object} component - El objeto del componente.
         * @returns {number} Vida restante calculada.
         */
        function calculateRemainingLife(component) {
            let totalLife = 0;
            let currentLife = 0;
            let remaining = 0;

            if (component.type === "hours") {
                totalLife = component.lifeLimitHours || 0;
                currentLife = currentAcHrs; // Horas acumuladas del helicóptero
                remaining = totalLife - currentLife; 
            } else if (component.type === "cycles") {
                totalLife = component.lifeLimitCycles || 0;
                currentLife = currentRins; // RINS acumulados del helicóptero
                remaining = totalLife - currentLife; 
            } else if (component.type === "months") { 
                totalLife = component.lifeLimitDays || 0; // Se asume que lifeLimitDays es el total de días de vida útil
                if (component.installationDate) {
                    const today = new Date();
                    const installationDate = new Date(component.installationDate);
                    // Calcula los días transcurridos desde la instalación
                    const timeDiff = today.getTime() - installationDate.getTime();
                    currentLife = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                    remaining = Math.max(0, totalLife - currentLife);
                } else {
                    remaining = totalLife; // Si no hay fecha de instalación, se asume vida completa restante
                }
            }
            return remaining;
        }

        /**
         * Determina la clase de color para el valor restante.
         * @param {number} remaining - Vida restante actual.
         * @param {number} totalLife - Vida útil total del componente.
         * @returns {string} Clase CSS para el color.
         */
        function getRemainingColorClass(remaining, totalLife) {
            if (totalLife === 0) return '';

            if (remaining <= 0) { 
                return 'remaining-red';
            } else {
                const percentageOfTotalLifeRemaining = (remaining / totalLife) * 100; 
                if (percentageOfTotalLifeRemaining < 20) {
                    return 'remaining-orange';
                } else {
                    return 'remaining-green';
                }
            }
        }

        /**
         * Calcula el porcentaje de vida consumida para la barra de progreso.
         * @param {object} component - El objeto del componente.
         * @returns {number} Porcentaje de vida consumida (0-100).
         */
        function calculateConsumedLifePercentage(component) {
            let totalLife = 0;
            let currentConsumed = 0;

            if (component.type === "hours") {
                totalLife = component.lifeLimitHours || 0;
                currentConsumed = currentAcHrs;
            } else if (component.type === "cycles") {
                totalLife = component.lifeLimitCycles || 0;
                currentConsumed = currentRins;
            } else if (component.type === "months") {
                totalLife = component.lifeLimitDays || 0;
                if (component.installationDate) {
                    const today = new Date();
                    const installationDate = new Date(component.installationDate);
                    const timeDiff = today.getTime() - installationDate.getTime();
                    currentConsumed = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                }
            }

            if (totalLife === 0) return 0;
            return Math.min(100, Math.max(0, (currentConsumed / totalLife) * 100));
        }

        // Función para poblar los selectores de mes y año
        function populateMonthYearSelectors() {
            monthSelect.innerHTML = '';
            months.forEach((month, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = month;
                if (index === currentMonth) {
                    option.selected = true;
                }
                monthSelect.appendChild(option);
            });

            yearSelect.innerHTML = '';
            years.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                if (year === currentYear) {
                    option.selected = true;
                }
                yearSelect.appendChild(option);
            });

            monthSelect.addEventListener('change', (event) => {
                currentMonth = parseInt(event.target.value);
                loadMonthlyTotalsFromFirebase();
            });
            yearSelect.addEventListener('change', (event) => {
                currentYear = parseInt(event.target.value);
                loadMonthlyTotalsFromFirebase();
            });
        }

        // Función para cargar los totales mensuales desde Firebase Realtime Database
        function loadMonthlyTotalsFromFirebase() {
            const rutaDatosMes = `artifacts/${appId}/public_data/datos_vuelo/${currentYear}/${currentMonth}`;

            onValue(ref(database, rutaDatosMes), (snapshot) => {
                let monthlyTotals = { 'AC HRS': "0", 'ATERRIZAJES': "0", 'RINS': "0" };

                if (snapshot.exists()) {
                    const fetchedData = snapshot.val();
                    console.log(`Datos brutos de Firebase para ${months[currentMonth]} ${currentYear} (desde ${rutaDatosMes}):`, fetchedData);

                    if (Array.isArray(fetchedData) && fetchedData[0] && fetchedData[0][34] !== undefined) {
                        currentAcHrs = parseFloat(fetchedData[0][34]) || 0;
                        monthlyTotals['AC HRS'] = fetchedData[0][34];
                    } else {
                        console.warn("Datos para AC HRS no encontrados o en formato inesperado.");
                        currentAcHrs = 0;
                    }
                    if (Array.isArray(fetchedData) && fetchedData[1] && fetchedData[1][34] !== undefined) {
                        monthlyTotals['ATERRIZAJES'] = fetchedData[1][34];
                    } else {
                        console.warn("Datos para ATERRIZAJES no encontrados o en formato inesperado.");
                    }
                    if (Array.isArray(fetchedData) && fetchedData[2] && fetchedData[2][34] !== undefined) {
                        currentRins = parseFloat(fetchedData[2][34]) || 0;
                        monthlyTotals['RINS'] = fetchedData[2][34];
                    } else {
                        console.warn("Datos para RINS no encontrados o en formato inesperado.");
                        currentRins = 0;
                    }
                } else {
                    console.log(`No se encontraron datos para ${months[currentMonth]} ${currentYear} en Firebase Realtime Database.`);
                    currentAcHrs = 0;
                    currentRins = 0;
                }

                const totalsToRender = [
                    { name: "AC HRS", current: monthlyTotals['AC HRS'], type: "monthly_total" },
                    { name: "ATERRIZAJES", current: monthlyTotals['ATERRIZAJES'], type: "monthly_total" },
                    { name: "RINS", current: monthlyTotals['RINS'], type: "monthly_total" },
                    { name: "FECHA ACTUAL", current: new Date().toLocaleDateString('es-ES'), type: "current_date" }
                ];
                renderSummary(totalsToRender);
                filterAndRenderComponents();
            }, (error) => {
                console.error("Error al cargar los totales del mes desde Firebase Realtime Database:", error);
                generalSummaryDiv.innerHTML = `<p class="text-center text-red-600 col-span-full">Error al cargar los datos: ${error.message}</p>`;
            });
        }

        // Función para renderizar el resumen
        function renderSummary(data) {
            if (data.length === 0) {
                generalSummaryDiv.innerHTML = '<p class="text-center text-gray-600 col-span-full">No hay datos disponibles para el resumen.</p>';
                return;
            }

            generalSummaryDiv.innerHTML = '';
            data.forEach(item => {
                const card = document.createElement('div');
                card.className = 'summary-card';
                card.innerHTML = `
                    <h4>${item.name}</h4>
                    <p class="value">${item.current}</p>
                `;
                generalSummaryDiv.appendChild(card);
            });
        }

        // Función para cargar los componentes desde Firebase
        function loadComponentsFromFirebase() {
            const componentsRef = ref(database, `artifacts/${appId}/public_data/components`);
            
            onValue(componentsRef, (snapshot) => {
                if (snapshot.exists()) {
                    // Convierte el objeto de Firebase a un array de componentes
                    const componentsObject = snapshot.val();
                    principalComponents = Object.keys(componentsObject).map(key => componentsObject[key]);
                    console.log("Componentes cargados desde Firebase:", principalComponents);
                    filterAndRenderComponents();
                } else {
                    console.log("No se encontraron componentes en Firebase. Inicializando con datos predefinidos...");
                    // Si no hay datos, carga los componentes iniciales
                    principalComponents = initialPrincipalComponents;
                    // Guarda estos componentes iniciales en Firebase
                    const updates = {};
                    initialPrincipalComponents.forEach(comp => {
                        updates[comp.serialNumber] = comp;
                    });
                    set(componentsRef, updates)
                        .then(() => {
                            console.log("Datos iniciales de componentes guardados en Firebase.");
                            filterAndRenderComponents(); // Renderiza después de guardar
                        })
                        .catch((error) => {
                            console.error("Error al guardar los datos iniciales de componentes:", error);
                            componentDetailsDiv.innerHTML = `<p class="text-center text-red-600 col-span-full">Error al inicializar componentes: ${error.message}</p>`;
                        });
                }
            }, (error) => {
                console.error("Error al cargar los componentes desde Firebase:", error);
                componentDetailsDiv.innerHTML = `<p class="text-center text-red-600 col-span-full">Error al cargar componentes: ${error.message}</p>`;
            });
        }


        /**
         * Abre el diálogo de edición y precarga los datos del componente.
         * @param {object} component - El objeto del componente a editar.
         */
        function openEditDialog(component) {
            editInputs.serialNumberHidden.value = component.serialNumber || '';
            editInputs.name.value = component.name || '';
            editInputs.partNumber.value = component.partNumber || '';
            editInputs.serialNumber.value = component.serialNumber || '';
            editInputs.installationDate.value = component.installationDate || '';
            editInputs.location.value = component.location || '';
            editInputs.type.value = component.type || 'hours';

            editInputs.currentTSNHours.value = component.currentTSNHours || 0;
            editInputs.currentTSNCycles.value = component.currentTSNCycles || 0;
            editInputs.currentTSNDays.value = component.currentTSNDays || 0;
            editInputs.currentTSOHours.value = component.currentTSOHours || 0;
            editInputs.currentTSOCycles.value = component.currentTSOCycles || 0;
            editInputs.currentTSODays.value = component.currentTSODays || 0;

            editInputs.lifeLimitHours.value = component.lifeLimitHours || 0;
            editInputs.lifeLimitCycles.value = component.lifeLimitCycles || 0;
            editInputs.lifeLimitDays.value = component.lifeLimitDays || 0;

            editInputs.dueDateTT.value = component.dueDateTT || '';
            editInputs.status.value = component.status || '';
            editInputs.lastInspectionDate.value = component.lastInspectionDate || '';
            editInputs.nextInspectionDue.value = component.nextInspectionDue || '';

            editComponentDialog.showModal();
        }

        /**
         * Maneja el envío del formulario de edición para guardar los cambios en Firebase.
         * @param {Event} event - El evento de envío del formulario.
         */
        async function saveEditedComponent(event) {
            event.preventDefault();

            const oldSerialNumber = editInputs.serialNumberHidden.value;
            const newSerialNumber = editInputs.serialNumber.value;

            const updatedComponentData = {
                name: editInputs.name.value,
                partNumber: editInputs.partNumber.value,
                serialNumber: newSerialNumber, // Usa el nuevo número de serie (si se cambió)
                installationDate: editInputs.installationDate.value,
                location: editInputs.location.value,
                type: editInputs.type.value,
                currentTSNHours: parseInt(editInputs.currentTSNHours.value) || 0,
                currentTSNCycles: parseInt(editInputs.currentTSNCycles.value) || 0,
                currentTSNDays: parseInt(editInputs.currentTSNDays.value) || 0,
                currentTSOHours: parseInt(editInputs.currentTSOHours.value) || 0,
                currentTSOCycles: parseInt(editInputs.currentTSOCycles.value) || 0,
                currentTSODays: parseInt(editInputs.currentTSODays.value) || 0,
                lifeLimitHours: parseInt(editInputs.lifeLimitHours.value) || 0,
                lifeLimitCycles: parseInt(editInputs.lifeLimitCycles.value) || 0,
                lifeLimitDays: parseInt(editInputs.lifeLimitDays.value) || 0,
                dueDateTT: editInputs.dueDateTT.value,
                status: editInputs.status.value,
                lastInspectionDate: editInputs.lastInspectionDate.value,
                nextInspectionDue: editInputs.nextInspectionDue.value,
            };

            try {
                // Si el número de serie ha cambiado, necesitamos eliminar el antiguo y crear uno nuevo
                if (oldSerialNumber !== newSerialNumber) {
                    // Primero, elimina el componente antiguo
                    const oldComponentRef = ref(database, `artifacts/${appId}/public_data/components/${oldSerialNumber}`);
                    await set(oldComponentRef, null); // Establecer a null para eliminar

                    console.log(`Componente con serial antiguo ${oldSerialNumber} eliminado.`);
                }

                // Guarda o actualiza el componente con el nuevo (o el mismo) número de serie
                const newComponentRef = ref(database, `artifacts/${appId}/public_data/components/${newSerialNumber}`);
                await set(newComponentRef, updatedComponentData);

                console.log("Componente actualizado y guardado en Firebase:", updatedComponentData);
                editComponentDialog.close();
            } catch (error) {
                console.error("Error al guardar el componente en Firebase:", error);
            }
        }

        // Función para renderizar los detalles de los componentes
        function renderComponentDetails(componentsToDisplay) {
            componentDetailsDiv.innerHTML = '';

            if (componentsToDisplay.length === 0) {
                componentDetailsDiv.innerHTML = '<p class="text-center text-gray-600 col-span-full">No se encontraron componentes que coincidan con la búsqueda.</p>';
                return;
            }

            componentsToDisplay.forEach(component => {
                const remainingLife = calculateRemainingLife(component);
                const totalLifeForColor = component.type === "hours" ? component.lifeLimitHours : 
                                          component.type === "cycles" ? component.lifeLimitCycles : 
                                          component.lifeLimitDays;
                const colorClass = getRemainingColorClass(remainingLife, totalLifeForColor);

                let progressBarColorClass = '';
                if (remainingLife <= 0) {
                    progressBarColorClass = 'progress-red';
                } else {
                    const percentageOfTotalLifeRemaining = (remainingLife / totalLifeForColor) * 100;
                    if (percentageOfTotalLifeRemaining < 20) {
                        progressBarColorClass = 'progress-orange';
                    } else {
                        progressBarColorClass = 'progress-green';
                    }
                }

                const consumedPercentage = calculateConsumedLifePercentage(component);
                let unit = "unidades";
                let remainingLifeDisplay = remainingLife.toFixed(1);

                if (component.type === "hours") {
                    unit = "hrs";
                } else if (component.type === "cycles") {
                    unit = "ciclos";
                    remainingLifeDisplay = remainingLife.toFixed(0);
                } else if (component.type === "months") {
                    unit = "días";
                    remainingLifeDisplay = remainingLife.toFixed(0);
                }

                const card = document.createElement('div');
                card.className = 'component-card';
                card.id = `component-${component.serialNumber}`;
                card.innerHTML = `
                    <h4>${component.name}</h4>
                    <div class="card-buttons">
                        <button class="edit-button" data-serial="${component.serialNumber}">Editar</button>
                        <button class="print-single-button" data-serial="${component.serialNumber}">Imprimir</button>
                    </div>
                    <div class="component-info-grid">
                        <p><strong>No. Parte:</strong> ${component.partNumber || 'N/A'}</p>
                        <p><strong>No. Serie:</strong> ${component.serialNumber || 'N/A'}</p>
                        <p><strong>Instalado:</strong> ${component.installationDate || 'N/A'}</p>
                        <p><strong>Ubicación:</strong> ${component.location || 'N/A'}</p>
                        
                        <p><strong>Vida Límite (Hrs):</strong> ${component.lifeLimitHours || 0}</p>
                        <p><strong>Vida Límite (Ciclos):</strong> ${component.lifeLimitCycles || 0}</p>
                        <p><strong>Vida Límite (Días):</strong> ${component.lifeLimitDays || 0}</p>
                        <p><strong>Tipo de Vida:</strong> ${component.type || 'N/A'}</p>

                        <p><strong>TSN (Hrs):</strong> ${component.currentTSNHours || 0}</p>
                        <p><strong>TSN (Ciclos):</strong> ${component.currentTSNCycles || 0}</p>
                        <p><strong>TSN (Días):</strong> ${component.currentTSNDays || 0}</p>
                        <p><strong>TSO (Hrs):</strong> ${component.currentTSOHours || 0}</p>
                        <p><strong>TSO (Ciclos):</strong> ${component.currentTSOCycles || 0}</p>
                        <p><strong>TSO (Días):</strong> ${component.currentTSODays || 0}</p>

                        <p><strong>Última Inspección:</strong> ${component.lastInspectionDate || 'N/A'}</p>
                        <p><strong>Próxima Inspección:</strong> ${component.nextInspectionDue || 'N/A'}</p>
                        <p><strong>Vencimiento (A LAS TT):</strong> ${component.dueDateTT || 'N/A'}</p>
                        <p><strong>Estado:</strong> ${component.status || 'N/A'}</p>
                    </div>
                    <div class="remaining-life-section">
                        <span>Remanente:</span>
                        <span class="${colorClass}">${remainingLifeDisplay} ${unit}</span>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar-fill ${progressBarColorClass}" style="width: ${consumedPercentage}%;">
                            ${consumedPercentage.toFixed(0)}% Consumido
                        </div>
                    </div>
                `;
                componentDetailsDiv.appendChild(card);

                const editButton = card.querySelector('.edit-button');
                editButton.addEventListener('click', () => {
                    const selectedComponent = principalComponents.find(comp => comp.serialNumber === editButton.dataset.serial);
                    if (selectedComponent) {
                        openEditDialog(selectedComponent);
                    }
                });

                const printSingleButton = card.querySelector('.print-single-button');
                printSingleButton.addEventListener('click', () => {
                    printComponents(component.serialNumber);
                });
            });
        }

        // Función para filtrar y renderizar componentes
        function filterAndRenderComponents() {
            const searchTerm = componentSearchInput.value.toLowerCase();
            const filteredComponents = principalComponents.filter(component => {
                const nameMatch = component.name.toLowerCase().includes(searchTerm);
                const serialMatch = (component.serialNumber || '').toLowerCase().includes(searchTerm);
                const partMatch = (component.partNumber || '').toLowerCase().includes(searchTerm);
                return nameMatch || serialMatch || partMatch;
            });
            renderComponentDetails(filteredComponents);
        }

        /**
         * Función para manejar la impresión de componentes.
         * @param {string|null} serialNumber - El número de serie del componente a imprimir, o null para imprimir todos.
         */
        function printComponents(serialNumber = null) {
            const body = document.body;
            
            if (serialNumber) {
                body.classList.add('print-single-component');
                const componentToPrint = document.getElementById(`component-${serialNumber}`);
                if (componentToPrint) {
                    componentToPrint.classList.add('print-this-one');
                }
            }

            window.print();

            setTimeout(() => {
                if (serialNumber) {
                    body.classList.remove('print-single-component');
                    const componentToPrint = document.getElementById(`component-${serialNumber}`);
                    if (componentToPrint) {
                        componentToPrint.classList.remove('print-this-one');
                    }
                }
            }, 500);
        }

        // Se ejecuta cuando el DOM está completamente cargado
        document.addEventListener('DOMContentLoaded', () => {
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    console.log("Usuario autenticado en COMPONENTES980.HTML:", user.uid);
                    populateMonthYearSelectors();
                    loadMonthlyTotalsFromFirebase();
                    loadComponentsFromFirebase(); // Carga los componentes desde Firebase

                    componentSearchInput.addEventListener('input', filterAndRenderComponents);
                    editComponentForm.addEventListener('submit', saveEditedComponent);
                    cancelEditButton.addEventListener('click', () => editComponentDialog.close());
                    printAllComponentsButton.addEventListener('click', () => printComponents());

                } else {
                    console.log("No hay usuario autenticado en COMPONENTES980.HTML. Intentando autenticación anónima...");
                    try {
                        // Intenta iniciar sesión anónimamente si no hay token inicial
                        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
                        if (initialAuthToken) {
                            await signInWithCustomToken(auth, initialAuthToken);
                            console.log("Autenticación con token inicial exitosa.");
                        } else {
                            await signInAnonymously(auth);
                            console.log("Autenticación anónima exitosa.");
                        }
                        // Vuelve a llamar la lógica de inicialización si la autenticación anónima es exitosa
                        populateMonthYearSelectors();
                        loadMonthlyTotalsFromFirebase();
                        loadComponentsFromFirebase();
                        componentSearchInput.addEventListener('input', filterAndRenderComponents);
                        editComponentForm.addEventListener('submit', saveEditedComponent);
                        cancelEditButton.addEventListener('click', () => editComponentDialog.close());
                        printAllComponentsButton.addEventListener('click', () => printComponents());

                    } catch (error) {
                        console.error("Error en la autenticación:", error);
                        generalSummaryDiv.innerHTML = '<p class="text-center text-red-600 col-span-full">Error de autenticación. Por favor, intenta de nuevo.</p>';
                        componentDetailsDiv.innerHTML = '<p class="text-center text-red-600 col-span-full">Error de autenticación. No se pueden cargar los componentes.</p>';
                    }
                }
            });
        });
    </script>
</body>
</html>
